var a="1.0.0";var l=/^application\/(?:[^\s+]+?[+])?json$/,h=i=>l.test(i),c=i=>Object.prototype.toString.call(i),n=i=>c(i)==="[object Blob]";var r=class{constructor(t,e){var o;let s={offset:0,limit:null,...e,fetchOptions:{method:"GET",...e==null?void 0:e.fetchOptions,headers:{accept:"application/json",...(o=e==null?void 0:e.fetchOptions)==null?void 0:o.headers}}};this._class=Object.getPrototypeOf(this).constructor,this._url=new URL(t),this._url.search="",this._initialUrl=new URL(this.url),this._options=s,this._type=null,this._limit=s.limit||null,this._offset=s.offset||null,this._hasMore=null,this._updateUrlSearchParameters(),this._filters={}}get url(){return this._url.href}get hasData(){return typeof this._data!="undefined"&&this.data!==null}get data(){return this._throwIfNoData(),this._data}get binaryData(){return this._throwIfNoData(),this._binaryData}get jsonData(){return this._throwIfNoData(),this._jsonData}get limit(){return this._limit}get offset(){return this._offset}get hasMore(){return this._hasMore}get isCollection(){return this._throwIfNoData(),this._type===this._class.type.COLLECTION}get isItem(){return this._throwIfNoData(),this._type===this._class.type.ITEM}get isMedia(){return this._throwIfNoData(),this._type===this._class.type.MEDIA}get isOther(){return this._throwIfNoData(),this._type===this._class.type.OTHER}addFilter(t,e,s){this._filters[t]={operator:s}}_throwIfNoData(){if(!this._data)throw new Error("ORDSResource: No data available in the resource. Have you made a request?")}_throwIfNoJsonData(){if(this._throwIfNoData(),!this._jsonData)throw new Error("ORDSResource: No JSON data available in the resource")}_throwIfNotCollection(){if(!this.isCollection)throw new Error("ORDSResource: The current resource is not a COLLECTION type resource")}_throwIfNotItem(){if(!this.isItem())throw new Error("ORDSResource: The current resource is not a ITEM type resource")}_updateUrlSearchParameters(){this._limit?this._url.searchParams.set("limit",this._limit):this._url.searchParams.delete("limit"),this._offset?this._url.searchParams.set("offset",this._offset):this._url.searchParams.delete("offset")}_discoverType(){this._throwIfNoData();let t=this._data;if(n(t)){this._type=this._class.type.MEDIA;return}if(Array.isArray(t.items)&&"limit"in t&&"offset"in t&&"hasMore"in t&&"links"in t){this._type=this._class.type.COLLECTION;return}if(Array.isArray(t.links)&&t.links.find(e=>e.href&&e.rel==="collection")){this._type=this._class.type.ITEM;return}this._type=this._class.type.OTHER}_discoverPagination(){if(this._throwIfNoJsonData(),this._type!==r.type.COLLECTION)return;let t=this._jsonData;this._limit=t.limit,this._offset=t.offset,this._hasMore=t.hasMore}_discoverLinks(){this._throwIfNoJsonData();let t=this._jsonData;if(!t.links||!Array.isArray(t.links)||!t.links.length){this._links={};return}this._links=t.links.reduce((e,s)=>!s.rel||!s.href?e:s.rel in e?(e[s.rel].push(s.href),e):(e[s.rel]=[s.href],e),{})}async makeRequest(){let t=await fetch(this.url,this._options.fetchOptions),e=t.headers.get("Content-Type"),s=h(e);if(!t.ok){let o=s?`
${await t.text()}
`:"";throw new Error(`ORDSResource: Resource request failed with status code "${t.status}"${o}`)}if(!s){this._data=await t.blob(),this._binaryData=this._data;return}this._data=await t.json(),this._jsonData=this._data,this._discoverType(),this._discoverPagination(),this._discoverLinks()}async requestNextPage(){var e,s;if(this._throwIfNoData(),this._throwIfNotCollection(),!this.hasMore)return console.warn("ORDSResource: Resource does not have more pages"),!1;let t=(s=(e=this._links)==null?void 0:e.next)==null?void 0:s[0];if(!t)throw new Error('ORDSResource: Data does not contain a "next" link reference');this._url=new URL(t),await this.makeRequest()}};r.version=a;r.type={COLLECTION:"COLLECTION",ITEM:"ITEM",MEDIA:"MEDIA",OTHER:"OTHER"};Object.seal(r.type);r.operator={EQUALS:"$eq",GREATER_THAN:"$gt",LESS_THAN:"$lt",NOT_EQUALS:"$ne",IN_STRING:"$instr",LIKE:"$like"};var _=class{};export{r as ORDSResource,_ as ORDSResourceItem};
/*! Copyright (c) 2022, Oracle and/or its affiliates. All rights reserved */
